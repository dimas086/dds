<!-- finance/templates/finance/transaction_form.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{% if form.instance.pk %}Редактировать{% else %}Создать{% endif %} запись</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.querySelector('#id_type');
            const categorySelect = document.querySelector('#id_category');
            const subcategorySelect = document.querySelector('#id_subcategory');

            typeSelect.addEventListener('change', function() {
                const typeId = this.value;
                fetch(`/get_categories/?type_id=${typeId}`)
                    .then(response => response.json())
                    .then(data => {
                        categorySelect.innerHTML = '<option value="">Выберите категорию</option>';
                        data.forEach(category => {
                            categorySelect.innerHTML += `<option value="${category.id}">${category.name}</option>`;
                        });
                        subcategorySelect.innerHTML = '<option value="">Выберите подкатегорию</option>';
                    });
            });

            categorySelect.addEventListener('change', function() {
                const categoryId = this.value;
                fetch(`/get_subcategories/?category_id=${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        subcategorySelect.innerHTML = '<option value="">Выберите подкатегорию</option>';
                        data.forEach(subcategory => {
                            subcategorySelect.innerHTML += `<option value="${subcategory.id}">${subcategory.name}</option>`;
                        });
                    });
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>{% if form.instance.pk %}Редактировать{% else %}Создать{% endif %} запись</h1>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="{% url 'transaction_list' %}" class="btn btn-secondary">Отмена</a>
        </form>
    </div>
</body>
</html>